{
  "version": "0.8.0",
  "name": "Mind⠶Flow Pipeline",
  "description": "Real-time typing intelligence with local LM",
  "nodes": [
    {
      "id": "input",
      "type": "source",
      "label": "User Input",
      "description": "Keystroke capture from any text field",
      "module": "src/pipeline/monitor.ts",
      "connections": ["scheduler"]
    },
    {
      "id": "scheduler",
      "type": "orchestrator",
      "label": "Sweep Scheduler",
      "description": "Pause detection, timing control, burst/pause orchestration",
      "module": "src/pipeline/scheduler.ts",
      "connections": ["region-policy", "correction-wave"],
      "config": {
        "pauseThresholdMs": 600,
        "tickIntervalMs": 75,
        "deviceTierAware": true
      }
    },
    {
      "id": "region-policy",
      "type": "compute",
      "label": "Active Region Policy",
      "description": "Computes editable window (~20 words behind caret)",
      "module": "src/region/policy.ts",
      "connections": ["diffusion"],
      "config": {
        "defaultWords": 20,
        "burstGrowthEnabled": true,
        "caretSafetyEnforced": true
      }
    },
    {
      "id": "diffusion",
      "type": "control",
      "label": "Diffusion Controller",
      "description": "Advances frontier word-by-word, manages streaming tick",
      "module": "src/region/diffusion.ts",
      "connections": ["stage-noise"]
    },
    {
      "id": "correction-wave",
      "type": "orchestrator",
      "label": "Correction Wave",
      "description": "Sequential three-stage pipeline execution",
      "module": "src/pipeline/correctionWave.ts",
      "connections": ["stage-noise", "stage-context", "stage-tone"]
    },
    {
      "id": "stage-noise",
      "type": "transformer",
      "label": "Noise Stage",
      "description": "LM-only typo corrections within caret-safe band",
      "module": "src/stages/noise.ts",
      "connections": ["lm-adapter", "stage-context"],
      "config": {
        "deterministic": false,
        "lmOnly": true,
        "maxNewTokens": 32
      }
    },
    {
      "id": "stage-context",
      "type": "transformer",
      "label": "Context Stage",
      "description": "Grammar & coherence via LM + confidence gating",
      "module": "src/stages/context.ts",
      "connections": ["lm-adapter", "confidence-gate", "stage-tone"],
      "config": {
        "contextWindow": "±2 sentences",
        "englishOnly": true,
        "requiresInputFidelity": 0.55
      }
    },
    {
      "id": "stage-tone",
      "type": "transformer",
      "label": "Tone Stage",
      "description": "Optional tone adjustment (None/Casual/Professional)",
      "module": "src/stages/tone.ts",
      "connections": ["lm-adapter", "confidence-gate", "ui-render"],
      "config": {
        "defaultMode": "None",
        "conservativeGating": true,
        "toneThreshold": 0.75
      }
    },
    {
      "id": "lm-adapter",
      "type": "service",
      "label": "LM Adapter",
      "description": "Local language model (Qwen2.5-0.5B q4)",
      "module": "src/lm/workerAdapter.ts",
      "config": {
        "modelPath": "mindtype/models/onnx-community/Qwen2.5-0.5B-Instruct",
        "backend": "webgpu→wasm→cpu",
        "tokenCaps": { "webgpu": 48, "wasm": 24, "cpu": 16 }
      }
    },
    {
      "id": "confidence-gate",
      "type": "validator",
      "label": "Confidence Gate",
      "description": "Quality gating for Context/Tone proposals",
      "module": "src/pipeline/confidenceGate.ts",
      "config": {
        "τ_input": 0.55,
        "τ_commit": 0.8,
        "τ_tone": 0.75
      }
    },
    {
      "id": "ui-render",
      "type": "sink",
      "label": "UI Rendering",
      "description": "Web demo (React/Vite) with logging + visual feedback",
      "module": "hosts/web/src/App.tsx",
      "connections": ["correction-marker", "highlighter", "rollback"],
      "config": {
        "reducedMotion": "respect",
        "accessibility": "wcag-aa"
      }
    },
    {
      "id": "correction-marker",
      "type": "visual",
      "label": "Correction Marker",
      "description": "Braille animation (listening/correction modes)",
      "module": "src/ui/marker.ts"
    },
    {
      "id": "highlighter",
      "type": "visual",
      "label": "Active Region Highlight",
      "description": "Shimmer effect behind caret",
      "module": "src/ui/highlighter.ts"
    },
    {
      "id": "rollback",
      "type": "control",
      "label": "Rollback Handler",
      "description": "Atomic wave undo (Cmd+Alt+Z)",
      "module": "src/ui/rollback.ts"
    }
  ],
  "hosts": [
    {
      "id": "web",
      "label": "Web Demo",
      "path": "hosts/web/",
      "description": "Vite/React playground with live controls"
    },
    {
      "id": "macos",
      "label": "macOS Menu Bar",
      "path": "hosts/macos/",
      "description": "SwiftUI app with AX integration + FFI to Rust"
    }
  ],
  "metadata": {
    "updated": "2025-11-20",
    "architecture": "LM-only pipeline with caret-safe Active Region",
    "principles": [
      "Caret-Safe Guarantee",
      "Privacy-First (on-device)",
      "Burst-Pause-Correct Rhythm",
      "Device-Tier Adaptive Performance"
    ]
  }
}



